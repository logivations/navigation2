<!--
  This Behavior Tree replans the global path periodically at 1 Hz.
-->
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <SequenceStar name="GetWaypoints">
      <GetW2MOWaypoints goal="{goal}" waypoints="{waypoints}"/>
      <PipelineSequence name="NavigateWithReplanning">
        <RateController hz="0.5">
          <ReactiveFallback name="PathPlanningFallback">
            <!-- 1) try to follow the w2mo path. This fails, if the path is too far away from current pose, or if there is an obstacle on the path in front of us.-->
            <FollowW2MOPath waypoints="{waypoints}" path="{path}"/>
            <!-- if the path cannot be followed, try free navigation to the next reachable point on the path-->
            <SequenceStar name="AvoidObstacle">
              <FindFreeGoalOnPath waypoints="{waypoints}" goal="{subgoal}"/>
              <!-- computePathToPose is the HybridA* planner-->
              <ComputePathToPose goal="{subgoal}" path="{path}" planner_id="HybridAStar"/> 
              <<!-- VerifyLaneChange path="{path}"/> -->
            </SequenceStar>            
            <Wait wait_duration="1"/>
          </ReactiveFallback>
        </RateController>
        <FollowPath path="{path}"  controller_id="DynamicFollowPath"/>
      </PipelineSequence>  
    </SequenceStar>    
  </BehaviorTree>
</root>